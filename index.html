<!--
INSTRUCTIONS
CREATION D'UNE TODOLIST EN JS

afficher nom et date en json
json task également

add element
close element
time
date todolist

todo (à faire) : bleue
done (fait) : vert
to late (en retard) : rouge


Onclick sur la "puce"s: vérifier s'il est dans le temps imparti, si ok vert sinon rouge
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Todolist</title>
    <link rel="stylesheet" href="./css/my.css">
  </head>
  <body>
    <div id="result"></div>

    <div id="main">
      <div id="haut">
        <div id="prenom"></div>
        <div id="date"></div>
      </div>
      <div id="milieu">
        Liste des tâches
        <hr>
        <div class="blocbleu"> <!-- à faire -->
          <div class="soustitre">A faire</div>
          <div id="add1"></div>
        </div>
        <div class="blocvert"> <!-- fait -->
          <div class="soustitre">Fait</div>
          <div id="add2"></div>
        </div>

        <div class="blocrouge"> <!-- en retard -->
          <div class="soustitre">En retard</div>
          <div id="add3"></div>
        </div>
      </div>
      <div id="bas">
      </div>
    </div>
</body>


  <script>
  var getJSON = function(url) {
    return new Promise(function(resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open('get', url, true);
      xhr.responseType = 'json';
      xhr.onload = function() {
        var status = xhr.status;
        if (status == 200) {
          resolve(xhr.response);
        } else {
          reject(status);
        }
      };
      xhr.send();
    });
  };



  getJSON('./json/fr.json').then(function(data) {

      for (var i = 0; i < data.length; i++) {

        if(data[i].prenom != "John") {return false;}
        document.getElementById('prenom').innerText += ' ' + data[i].prenom;

        for (var i2 = 0; i2 < data[i].taches.length; i2++) {
          if(data[i].taches[i2].status==1) /*fait - ADD2*/
          {
            document.getElementById('add2').innerHTML += '<div id="plus'+ data[i].taches[i2].id  +'"><img src="./img/plus.png" width="12px"></div>' + '<div id="moins'+ data[i].taches[i2].id  +'"><img src="./img/minus.png" width="12px"></div>';
            document.getElementById('add2').innerHTML += '<div id="'+ data[i].taches[i2].id  +'"> '+ data[i].taches[i2].tache + data[i].taches[i2].date + data[i].taches[i2].datefin + '<br></div>';
          }
          else if(data[i].taches[i2].status==2) /*en retard - ADD3*/
          {
            document.getElementById('add3').innerHTML += '<div id="plus'+ data[i].taches[i2].id  +'"><img src="./img/plus.png" width="12px"></div>' + '<div id="moins'+ data[i].taches[i2].id  +'"><img src="./img/minus.png" width="12px"></div>';
            document.getElementById('add3').innerHTML += '<div id="'+ data[i].taches[i2].id  +'"> '+ data[i].taches[i2].tache + data[i].taches[i2].date + data[i].taches[i2].datefin + '<br></div>';
          }
          else /*à faire - ADD1*/
          {
            document.getElementById('add1').innerHTML += '<div id="plus'+ data[i].taches[i2].id  +'"><img src="./img/plus.png" width="12px"></div>' + '<div id="moins'+ data[i].taches[i2].id  +'"><img src="./img/minus.png" width="12px"></div>';
            document.getElementById('add1').innerHTML += '<div id="'+ data[i].taches[i2].id  +'"> '+ data[i].taches[i2].tache + data[i].taches[i2].date + data[i].taches[i2].datefin + '<br></div>';
          }
        }
      }

  }, function(status) {
    alert('Le fichier JSON est introuvable.');
  });
  function dateFr()
  {
     // les noms de jours / mois
     var jours = new Array("dimanche", "lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi");
     var mois = new Array("janvier", "fevrier", "mars", "avril", "mai", "juin", "juillet", "aout", "septembre", "octobre", "novembre", "decembre");
     // on recupere la date
     var date = new Date();
     // on construit le message
     var message = /*jours[date.getDay()] + */"";   // nom du jour
     message += date.getDate() + " ";   // numero du jour
     message += mois[date.getMonth()] + " ";   // mois
     message += date.getFullYear();
     return message;
  }
  function heure()
  {
     var date = new Date();
     var heure = date.getHours();
     var minutes = date.getMinutes();
     if(minutes < 10)
          minutes = "0" + minutes;
     return heure + "h" + minutes;
   }
   document.getElementById('date').innerText = dateFr() + ' - ' + heure();
   function actuDateHeure(){
     document.getElementById('date').innerText = dateFr() + ' - ' + heure();}

  setInterval(actuDateHeure, 1000);

  </script>
  <script type="text/javascript" src="./js/jquery.min.js"></script>
</html>
